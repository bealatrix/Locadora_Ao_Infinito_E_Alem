@page "/verificarLocacoes"
@using Locadora_Ao_Infinito_E_Alem.Models
@inject NavigationManager navegacao;

<h3>Verificar Locações de Filmes</h3>

<div class="container">
    <h2 class="mt-4 text-center text-warning">Locações Cadastradas</h2>

    <!-- Filtros de Pesquisa -->
    <div class="mb-3">
        <label for="filtroStatus" class="form-label">Filtrar por Status:</label>
        <select @bind="filtroStatus" class="form-select" id="filtroStatus">
            <option value="">Todos</option>
            <option value="Atrasada">Atrasada</option>
            <option value="Em Andamento">Em Andamento</option>
            <option value="Finalizada">Finalizada</option>
        </select>
    </div>

    <!-- Tabela de Locações -->
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID Locação</th>
                <th>ID Filme</th>
                <th>Quantidade</th>
                <th>Valor</th>
                <th>Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var locacao in locacoesFiltradas)
            {
                <tr>
                    <td>@locacao.ID</td>
                    <td>@locacao.IDFilme</td>
                    <td>@locacao.quantidade</td>
                    <td>@locacao.valor</td>
                    <td>@locacao.status</td>
                    <td>
                        @if (locacao.status != "Finalizada")
                        {
                            <button class="btn btn-success btn-sm" @onclick="() => MarcarComoDevolvido(locacao.ID)">Marcar como Devolvido</button>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Finalizada</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@code {
    private string filtroStatus = "";
    private List<LocacaoFilme> locacoes = new List<LocacaoFilme>(); // Supondo que esta lista seja preenchida com as locações do banco de dados.
    private List<LocacaoFilme> locacoesFiltradas => locacoes
        .Where(l => string.IsNullOrEmpty(filtroStatus) || l.status == filtroStatus)
        .ToList();

    private void MarcarComoDevolvido(int idLocacao)
    {
        var locacao = locacoes.FirstOrDefault(l => l.ID == idLocacao);
        if (locacao != null)
        {
            locacao.status = "Finalizada";
            // Aqui você pode salvar a alteração no banco de dados.
        }
    }
}